<html lang="en">
<title>VAULT Crosswalk</title>
<!-- body id for specificity in CSS below -->
<body id="body">
<h1>EQUELLA -> InvenioRDM Crosswalk</h1>

<p>For our VAULT migration. This page uses <a href="https://mermaid.js.org/">Mermaid</a> <a href="https://mermaid.js.org/syntax/flowchart.html">flowcharts</a>. The left-side nodes are <a href="https://cca.github.io/vault_schema/">EQUELLA XML paths</a> or a JSON path for the non-XML diagram. They progress to <a href="https://inveniordm.docs.cern.ch/reference/metadata/">the Invenio field</a> on the right, which has its cardinality in parentheses.</p>

<p>Rounded nodes and dotted lines represent fields we're not migrating. See bottom of the non-XML mapping, for instance.</p>

<pre class="mermaid">
    ---
    title: MODS (/xml/mods) Mappings
    ---
    flowchart LR
    TITLE[titleInfo/title] --> |titles <i>after the 1st</i>, type based on <code>@type</code>| ADTITLE["Additional Titles (0-n)"]
    TITLE --> |Split author out of artists books| CREATORS
    SUBTITLE[titleInfo/subtitle] -->|type=<code>subtitle</code>| ADTITLE
    PARTNUMBER[titleInfo/partNumber] -->|type=<code>other</code>, Number prefix| ADTITLE
    ABSTRACTS[abstract] ---> |1st one| DESCRIPTION["Description (0-1)"]
    ABSTRACTS --> |abstracts <i>after the 1st</i>, type=<code>abstract</code>| ADDLDESC["Additional Descriptions (0-n)"]
    NAMENOTE[name/subNameWrapper/description] --> CREATORNOTE["Combined into creator note"]
    NAMEAFFILIATION[name/subNameWrapper/affiliation] -->|Non-CCA affiliation| CREATORNOTE
    NAMECONSTITUENT[name/subNameWrapper/constituent] -->|CCA type, e.g. faculty/student| CREATORNOTE
    NAMEDEPARTMENT[name/subNameWrapper/department] -->|CCA departments| CREATORNOTE
    NAMEGRAD[name/subNameWrapper/gradDate] -->|Graduation/employment dates| CREATORNOTE
    CREATORNOTE -->|type=<code>other</code>, Creator note prefix| ADDLDESC
    NOTES[noteWrapper/note] -->|See <a href="https://www.loc.gov/standards/mods/mods-notes.html">MODS note types</a>, type=<code>other</code>| ADDLDESC
    PHYSDESCNOTE[physicalDescriptionNote] -->|type=<code>other</code>| ADDLDESC
    BOOKCHAPTER["Faculty Research book chapter"] -->|"'Published in <i>title</i>', type=<code>series</code>"| ADDLDESC
    TOC[tableOfContents] -->|type=<code>table-of-contents</code>| ADDLDESC
    RTYPE[typeOfResourceWrapper/typeOfResource] -->|Use the 1st in the absence of <code>formBroad</code>| TYPE["Resource Type (1)"]
    FORMBROAD[physicalDescription/formBroad] -->|Prefer specificity over <code>typeOfResource</code>| TYPE
    NAMES[name/namePart] -->|Parse, org or person, 1 or many| NAMEDETAILS["roleTerm -> role, subName affiliations"]
    NAMEDETAILS --> CREATORS["Creators (1-n)"]
    DATECREATED[origininfo/dateCreatedWrapper/dateCreated] -->DATELOGIC["Use MODS if present else item.dateCreated"]
    SEMCREATED[origininfo/semesterCreated] -->DATELOGIC
    RELITEMDATE[relatedItem/part/date] -->DATELOGIC
    DATELOGIC -->PUBDATE["Publication Date (1)"]
    DATECAPT["origininfo/dateCaptured"] -->|date.type=<code>collected</code>| DATES["Dates (0-n)"]
    DATEOTHER["origininfo/dateOtherWrapper/dateOther"] -->|date.type=<code>other</code>| DATES
    %% CONTRIBUTORS["Contributors (0-n)"]
    ACCESSCONDITION["accessCondition"] -->|default to copyright if no license| RIGHTS["Rights (Licenses) (0-n)"]
    FORMBROAD --> SUBJECTSMAP["Subjects Map Lookup"]
    FORMSPECIFIC["physicalDescription/formSpecific"] --> SUBJECTSMAP
    GENRE["genreWrapper/genre"] --> SUBJECTSMAP
    MODSUBJECT["subject"] --> SUBJECTSMAP
    PHOTOCLASSIFICATION["photoClassification (CCA/C Subject)"] -->SUBJECTSMAP
    SUBJECTSMAP -->|id if found, keyword otherwise| SUBJECTS["Subjects (0-n)"]
    OIPUB["originInfo/publisher"] --> PUBLISHER["Publisher (0-1)"]
    DBR["relatedItem/title = Design Book Review"] --> |different depending on date| PUBLISHER
    HOSTCOLLECTION["relatedItem[@type=<code>host</code>]/title"] -->|Libraries Subcollections e.g. Mudflats| COMM["Communities (1-n)"]
    RELATEDURL["relateditem/location"] -->|verify URL, use relateditem@type for relation_type| REL["Related Identifiers/Works (0-n)"]
    RELATEDSTANDARDNUM["relatedItem[@type=<code>host</code>]/identifier[@type=<code>ISSN</code>|ISBN]"] -->|relation_type=<code></code><code>ispublishedin</code>|REL
    DOI["identifier@type=<code>doi</code>"] -->|relation_type=<code></code><code>isidenticalto</code>| REL
    LOCATIONURL["location/url"] -->|verify URL, relation_type=<code></code><code>isidenticalto</code>| REL
    EXTENT["physicalDescription/extent"] --> SIZES["Sizes (0-n)"]
    LOCATION["location"] --> |physicalLocation->place, copyInformation->description| LOCATIONS["Locations (0-n)"]
    ID[identifier] -->|"@type=<code>DOI</code> in Faculty Research collection"| ALTID["Alternate Identifiers (0-n)"]
</pre>

<p>We are not using the Funders or References fields. Few (no?) VAULT items have funding information and none have the identifiers that Invenio expects. We don't have References lists for any items.</p>

<pre class="mermaid">
    ---
    title: Local (/xml/local) Mappings
    ---
    flowchart LR
    USAGEREQUESTS["usageRequestWrapper/usageRequest"] --> ADDLDESC["Additional Descriptions (0-n)"]
    ASERIESV["archivesWrapper/series & subseries"] --> ASERIESI["cca:archive_series"]
    VLDEPT["department"] --> CDEPTCODE["cca:course.department"]{}
    VCIDEPT["courseInfo/department"] --> CDEPT["cca:course.department_code"]
    VFACULTY["courseInfo/faculty"] --> CINSTRUCTORS["cca:course.instructors"]
    VFACULTY --> |If we do not have a mods/name| CREATORS["Creators (1-n)"]
    VSECTION["courseInfo/section"] --> CSECTION["cca:course.section"]
    VSEMESTER["courseInfo/semester"] --> CTERM["cca:course.term"]
    VSECTION --> CSECTIONCALCID["cca:course.section_calc_id constructed from section & term"]
    VSEMESTER --> CSECTIONCALCID
    VCTITLE["courseInfo/title"] --> CTITLE["cca:course.title"]
    VIEWLEVEL["viewLevel"] --> |public -> public, anything else -> restricted| ACCESS["<a href="https://inveniordm.docs.cern.ch/reference/metadata/#access">Access</a>"]
    courseworktype[courseWorkWrapper/courseWorkType] --> |TODO if we have no mods/typeOfResource, map 1st| TYPE["Resource Type (1)"]
</pre>

<p>Basically, <code>/local/courseInfo</code> maps to a <code>cca:course</code> custom field while <code>/local/archivesWrapper</code> maps to a <code>cca:archive</code> custom field.</p>

<pre class="mermaid">
    ---
    title: Journal Articles
    ---
    flowchart TB
    GENRE["mods/genre or mods/genreWrapper/genre"] --> |Check for article, journal article, or journal| GENRECHECK{"Is article?"}
    GENRECHECK -->|Yes| RELATEDHOST["mods/relatedItem[@type=<code>host</code>]"]
    GENRECHECK -->|No| NOJOURNAL["No journal custom field"]
    RELATEDHOST --> JOURNALTITLE["title or titleInfo/title"]
    RELATEDHOST --> ISSN["identifier[@type=<code>issn</code>]"]
    RELATEDHOST --> VOLISSUE["part/detail[@type=<code>volume</code>|<code>number</code>]"]
    RELATEDHOST --> PAGES["part/extent[@unit=<code>page</code>]"]
    JOURNALTITLE --> JFIELD["journal.title"]
    ISSN --> JFIELD2["journal.issn"]
    VOLISSUE --> JFIELD3["journal.volume & journal.issue"]
    PAGES --> JFIELD4["journal.pages"]
    JFIELD --> CUSTOMFIELD["journal custom field"]
    JFIELD2 --> CUSTOMFIELD
    JFIELD3 --> CUSTOMFIELD
    JFIELD4 --> CUSTOMFIELD
</pre>

<p>We use the journal custom field to capture journal information related to articles in the Faculty Research and Open Access Journal Articles (DBR) collections.</p>

<pre class="mermaid">
    ---
    title: Non-XML Mappings
    ---
    flowchart LR
    NAME["item.name"] --> |Use 'Untitled' if absent| TITLE["Title (1)"]
    VAULTID["item.uuid + item.version"] -->|"<code>isnewversionof</code> VAULT URL"| REL["Related Identifiers/Works (0-n)"]
    OWNER["item.owner.id"] -->|<a href="https://github.com/cca/cca_invenio/tree/main/site#set-owner">set_owner</a> script| PARENT["parent.owned_by.id"]
    COLLABORATORS["item.collaborators.id"] --> |TODO share item with them?| PARENT
    COLLECTION["item.collection.uuid"] -->|see also mods/relatedItem@type=<code>host</code>| COMM["Communities (1-n)"]
    DATECREATED["item.dateCreated"] -->|Use item creation timestamp if no date in MODS| PUBDATE["Publication Date (1)"]
    ATTACHMENTS[item.attachments] -->|guess MIME type from filenames| FORMATS["Formats (0-n)"]
    ATTACHMENTS -->|File, HTML, & Zip attachments| FILES["Files (0-n)"]
    ATTACHMENTS -->|URL, YouTube attachments are related works| REL
    STATUS["item.status"] -->|if <code>item.status = 'live'</code>| PUBLISH["Don't publish draft/archived items"]
</pre>

<p>There's additional, mostly administrative, metadata in the EQUELLA item JSON outside the XML. We represent file/attachment operations here, too.</p>

<p>While VAULT has version information, we plan only to migrate the most recent, live versions of items, so displaying the version number with no way to access prior iterations can only lead to confusion. The version number will still be accessible in the copies of VAULT metadata we store on migrated items.</p>

<p>We do not use displayFields, displayOptions, DRM, modifiedDate, navigation, rating, or thumbnail in the migration. Most of these are specific to EQUELLA's display features.</p>

<script type="module">
import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
function todoStyles() {
    document.querySelectorAll('.edgeLabel').forEach(el => {
        el.innerHTML = el.innerHTML.replace(/TODO/g, '<strong class="todo">TODO</strong>')
    })
}
mermaid.run({
    // find all "TODO" strings in labels and make them bold
    postRenderCallback: id => todoStyles(),
    querySelector: '.mermaid'
})
setTimeout(() => {
    todoStyles()
}, 1000);
</script>

<style>
body {
    font-size: 18px;
}

p {
    max-width: 60rem;
}

body pre {
    max-width: 100%;
}

#body .mermaid .flowchartTitleText {
    font-size: 1.5rem;
    font-weight: bold;
}

code,
.todo {
    color: maroon;
}
</style>
</body>
</html>
